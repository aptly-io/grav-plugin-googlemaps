/* Copyright 2015, 2016 Francis Meyvis */
/** Client part of the Grav googlemaps plugin*/
/// <reference path="typings/googlemaps/google.maps.d.ts" />
var io;!function(io){var aptly;!function(aptly){var grav_plugin_googlemaps;!function(grav_plugin_googlemaps){function initGoogleMaps(tagId,mapOptions,displayOptions,controlStyle){google.maps.controlStyle=controlStyle;var values=mapOptions.center.split(",");mapOptions.center=new google.maps.LatLng(values[0],values[1]);var map=new google.maps.Map(document.getElementById(tagId),mapOptions);if(displayOptions.hasOwnProperty("kmlUrl")){var overlayOptions={suppressInfoWindows:!0,preserveViewport:!1,map:map},overlay=new google.maps.KmlLayer(displayOptions.kmlUrl,overlayOptions);overlay.setMap(map),google.maps.event.addListener(overlay,"click",function(event){var kmlInfoDiv=document.getElementById(tagId+"_KmlInfo");kmlInfoDiv.innerHTML=event.featureData.infoWindowHtml}),!0===displayOptions.kmlStatus&&google.maps.event.addListener(overlay,"status_changed",function(){document.getElementById(tagId+"_KmlStatus").innerHTML=overlay.getStatus().toLocaleString()})}if(displayOptions.hasOwnProperty("markers")){var markerIdx;for(markerIdx in displayOptions.markers)setMarker(map,displayOptions.markers[markerIdx])}google.maps.event.addDomListener(window,"resize",function(){var center=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(center)}),gm_maps.push({map:map,center:map.getCenter(),zoom:map.getZoom()})}function setMarker(map,markerData){var values=markerData.location.split(","),markerOptions={position:new google.maps.LatLng(values[0],values[1]),animation:google.maps.Animation.DROP};if(markerData.hasOwnProperty("title")&&(markerOptions.title=markerData.title),markerData.hasOwnProperty("zIndex")&&(markerOptions.zIndex=parseInt(markerData.zIndex)),markerData.hasOwnProperty("icon")){var image={url:markerData.icon};markerOptions.icon=image}var marker=new google.maps.Marker(markerOptions);if(markerData.hasOwnProperty("info")){var infoWindowOptions={content:markerData.info},infoWindow=new google.maps.InfoWindow(infoWindowOptions);google.maps.event.addListener(marker,"click",function(e){infoWindow.open(map,marker)})}else markerData.hasOwnProperty("link")&&google.maps.event.addListener(marker,"click",function(e){window.location.href=markerData.link});var timeout=0;markerData.hasOwnProperty("timeout")&&(timeout=parseInt(markerData.timeout)),window.setTimeout(function(){marker.setMap(map)},timeout)}var gm_maps=[];grav_plugin_googlemaps.initGoogleMaps=initGoogleMaps}(grav_plugin_googlemaps=aptly.grav_plugin_googlemaps||(aptly.grav_plugin_googlemaps={}))}(aptly=io.aptly||(io.aptly={}))}(io||(io={}));